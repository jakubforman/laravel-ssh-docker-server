services:
  app:
    build:
      context: ./runtimes/8.4
      dockerfile: Dockerfile
      args:
        WWWGROUP: '${WWWGROUP:-1000}'
        POSTGRES_CLIENT: true
    image: laravel-ssh-server:8.4
    ports:
      - "8080:80"   # Web
      - "2222:22"   # SSH/SFTP pro PHP Deployer, a další části
    volumes:
      - ./dev.tripocket.cz:/var/www/html
    networks:
      - dev-tripocket
    depends_on:
      - pgsql
      - redis

  pgsql:
    image: 'postgis/postgis:15-3.3-alpine'
    environment:
      POSTGRES_DB: laravel
      POSTGRES_USER: sail
      POSTGRES_PASSWORD: password
    volumes:
      - 'dev-tripocket-pgsql:/var/lib/postgresql/data'
    networks:
      - dev-tripocket

  redis:
    image: redis:alpine
    volumes:
      - 'dev-tripocket-redis:/data'
    networks:
      - dev-tripocket

networks:
    dev-tripocket:
        driver: bridge
volumes:
    dev-tripocket-redis:
        driver: local
    dev-tripocket-pgsql:
        driver: local